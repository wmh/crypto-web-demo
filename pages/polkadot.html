<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polkadot ç¯„ä¾‹</title>
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ”´ Polkadot ç°½åèˆ‡äº¤æ˜“</h1>
        
        <nav class="nav-bar">
            <a href="../index.html">é¦–é </a>
            <a href="hash.html">é›œæ¹Šæ¼”ç®—æ³•</a>
            <a href="symmetric.html">å°ç¨±åŠ å¯†</a>
            <a href="asymmetric.html">éå°ç¨±åŠ å¯†</a>
            <a href="ethereum.html">Ethereum</a>
            <a href="bitcoin.html">Bitcoin</a>
            <a href="solana.html">Solana</a>
            <a href="cosmos.html">Cosmos</a>
            <a href="tron.html">Tron</a>
            <a href="polkadot.html" class="active">Polkadot</a>
        </nav>

        <div class="info-box">
            <h4>ğŸ”´ Polkadot ç°½åèˆ‡äº¤æ˜“</h4>
            <p>Polkadot ä½¿ç”¨ SR25519 ç°½åæ¼”ç®—æ³•ï¼ˆSchnorr ç°½åè®Šé«”ï¼‰ï¼Œä¹Ÿæ”¯æ´ Ed25519 å’Œ ECDSAã€‚åœ°å€ä½¿ç”¨ SS58 ç·¨ç¢¼æ ¼å¼ï¼Œä¸åŒç¶²è·¯æœ‰ä¸åŒçš„å‰ç¶´ï¼ˆPolkadot: 0, Kusama: 2ï¼‰ã€‚</p>
        </div>

        <div class="demo-section">
            <h3>1. ç”Ÿæˆ Polkadot éŒ¢åŒ… (SR25519)</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'dot-wallet-code')">è¤‡è£½</button>
                </div>
                <pre><code id="dot-wallet-code" class="language-javascript">// ä½¿ç”¨ @polkadot/util-crypto
const { 
    mnemonicGenerate, 
    mnemonicToMiniSecret,
    sr25519PairFromSeed,
    encodeAddress 
} = require('@polkadot/util-crypto');

// 1. ç”ŸæˆåŠ©è¨˜è© (BIP-39)
const mnemonic = mnemonicGenerate(12);

// 2. å¾åŠ©è¨˜è©ç”Ÿæˆç¨®å­
const seed = mnemonicToMiniSecret(mnemonic);

// 3. ç”Ÿæˆ SR25519 å¯†é‘°å°
const keyPair = sr25519PairFromSeed(seed);

// 4. ç”Ÿæˆåœ°å€ (SS58 ç·¨ç¢¼)
const address = encodeAddress(keyPair.publicKey, 0); // 0 = Polkadot

console.log("åŠ©è¨˜è©:", mnemonic);
console.log("åœ°å€:", address); // ä»¥ 1 é–‹é ­çš„åœ°å€
console.log("å…¬é‘°:", keyPair.publicKey);

// Kusama åœ°å€ (å‰ç¶´ 2)
const kusamaAddress = encodeAddress(keyPair.publicKey, 2);</code></pre>
            </div>

            <button onclick="generateDotWallet()">ç”Ÿæˆ Polkadot éŒ¢åŒ…</button>
            <div id="dotWalletOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>2. ç°½ç½²è¨Šæ¯ (SR25519)</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'dot-sign-code')">è¤‡è£½</button>
                </div>
                <pre><code id="dot-sign-code" class="language-javascript">// SR25519 ç°½å
const { sr25519Sign, sr25519Verify } = require('@polkadot/util-crypto');
const { stringToU8a } = require('@polkadot/util');

// æº–å‚™è¨Šæ¯
const message = "Polkadot message";
const messageU8a = stringToU8a(message);

// ç°½ç½²
const signature = sr25519Sign(messageU8a, keyPair);
console.log("ç°½å:", signature);

// é©—è­‰
const isValid = sr25519Verify(messageU8a, signature, keyPair.publicKey);
console.log("é©—è­‰çµæœ:", isValid);

// SR25519 ç‰¹é»:
// - åŸºæ–¼ Schnorr ç°½å
// - æ›´å®‰å…¨çš„éš¨æ©Ÿæ•¸ç”Ÿæˆ
// - æ”¯æ´æ‰¹æ¬¡é©—è­‰
// - ç°½åé•·åº¦ 64 bytes</code></pre>
            </div>

            <div class="input-group">
                <label>è¨Šæ¯ï¼š</label>
                <input type="text" id="dotMessage" value="Polkadot Ecosystem" placeholder="è¼¸å…¥è¦ç°½ç½²çš„è¨Šæ¯">
            </div>
            <button onclick="signDotMessage()">âœï¸ ç°½ç½²è¨Šæ¯</button>
            <button onclick="verifyDotMessage()">âœ… é©—è­‰ç°½å</button>
            <div id="dotMessageOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>3. å»ºç«‹ä¸¦ç°½ç½²è½‰å¸³äº¤æ˜“</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'dot-tx-code')">è¤‡è£½</button>
                </div>
                <pre><code id="dot-tx-code" class="language-javascript">// ä½¿ç”¨ @polkadot/api
const { ApiPromise, WsProvider } = require('@polkadot/api');

// 1. é€£æ¥ç¯€é»
const wsProvider = new WsProvider('wss://rpc.polkadot.io');
const api = await ApiPromise.create({ provider: wsProvider });

// 2. å»ºç«‹è½‰å¸³äº¤æ˜“
const transfer = api.tx.balances.transfer(
    recipientAddress,
    amount // ä»¥ Planck ç‚ºå–®ä½ (1 DOT = 10^10 Planck)
);

// 3. ç°½ç½²ä¸¦ç™¼é€
const hash = await transfer.signAndSend(keyPair, ({ status }) => {
    if (status.isInBlock) {
        console.log('äº¤æ˜“å·²æ‰“åŒ…:', hash.toString());
    } else if (status.isFinalized) {
        console.log('äº¤æ˜“å·²ç¢ºèª:', hash.toString());
    }
});

// Extrinsic (å¤–éƒ¨äº¤æ˜“) çµæ§‹:
// - Signature: SR25519 ç°½å
// - Era: äº¤æ˜“æœ‰æ•ˆæœŸ
// - Nonce: å¸³æˆ¶ nonce
// - Tip: å°è²» (åŠ é€Ÿæ‰“åŒ…)</code></pre>
            </div>

            <div class="input-group">
                <label>æ”¶æ¬¾åœ°å€ï¼š</label>
                <input type="text" id="dotToAddress" value="1FRMM8PEiWXYax7rpS6X4XZX1aAAxSWx1CrKTyrVYhV24fg" placeholder="1...">
            </div>
            <div class="input-group">
                <label>é‡‘é¡ (DOT)ï¼š</label>
                <input type="text" id="dotAmount" value="1" placeholder="1">
            </div>
            <button onclick="createDotTransaction()">ğŸ“ å»ºç«‹ä¸¦ç°½ç½²äº¤æ˜“</button>
            <div id="dotTxOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>4. è·¨éˆè½‰å¸³ (XCM)</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'xcm-code')">è¤‡è£½</button>
                </div>
                <pre><code id="xcm-code" class="language-javascript">// XCM (Cross-Consensus Message) - Polkadot è·¨éˆå”è­°
const { ApiPromise } = require('@polkadot/api');

// 1. å¾ä¸­ç¹¼éˆè½‰åˆ°å¹³è¡Œéˆ
const xcmTransfer = api.tx.xcmPallet.reserveTransferAssets(
    // ç›®æ¨™éˆ
    { V3: { parents: 0, interior: { X1: { Parachain: 2000 } } } },
    // å—ç›Šäºº
    { V3: { parents: 0, interior: { X1: { AccountId32: { 
        network: null, 
        id: recipientPublicKey 
    }}}}},
    // è³‡ç”¢
    { V3: [{ 
        id: { Concrete: { parents: 0, interior: 'Here' } },
        fun: { Fungible: amount }
    }]},
    0 // Fee asset item
);

// 2. ç°½ç½²ä¸¦ç™¼é€
await xcmTransfer.signAndSend(keyPair);

// XCM æ”¯æ´:
// - å¹³è¡Œéˆé–“è½‰å¸³
// - è·¨å…±è­˜è¨Šæ¯
// - é ç¨‹åŸ·è¡Œ
// - è³‡ç”¢è·¨éˆ</code></pre>
            </div>

            <div class="input-group">
                <label>ç›®æ¨™å¹³è¡Œéˆ IDï¼š</label>
                <input type="text" id="parachainId" value="2000" placeholder="2000 (Acala)">
            </div>
            <div class="input-group">
                <label>æ”¶æ¬¾åœ°å€ï¼š</label>
                <input type="text" id="xcmToAddress" value="1FRMM8PEiWXYax7rpS6X4XZX1aAAxSWx1CrKTyrVYhV24fg" placeholder="1...">
            </div>
            <div class="input-group">
                <label>é‡‘é¡ (DOT)ï¼š</label>
                <input type="text" id="xcmAmount" value="1" placeholder="1">
            </div>
            <button onclick="createXCMTransaction()">ğŸ“ å»ºç«‹ XCM äº¤æ˜“</button>
            <div id="xcmOutput" class="output"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="../scripts/polkadot.js"></script>
    <script>
        function copyCode(btn, codeId) {
            const code = document.getElementById(codeId).textContent;
            navigator.clipboard.writeText(code).then(() => {
                btn.textContent = 'å·²è¤‡è£½ï¼';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'è¤‡è£½';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
    </script>
</body>
</html>
