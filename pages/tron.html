<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tron ç¯„ä¾‹</title>
    <link rel="stylesheet" href="../styles/common.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
</head>
<body>
    <div class="container">
        <h1>âš¡ Tron ç°½åèˆ‡äº¤æ˜“</h1>
        
        <nav class="nav-bar">
            <a href="../index.html">é¦–é </a>
            <a href="hash.html">é›œæ¹Šæ¼”ç®—æ³•</a>
            <a href="symmetric.html">å°ç¨±åŠ å¯†</a>
            <a href="asymmetric.html">éå°ç¨±åŠ å¯†</a>
            <a href="ethereum.html">Ethereum</a>
            <a href="bitcoin.html">Bitcoin</a>
            <a href="solana.html">Solana</a>
            <a href="cosmos.html">Cosmos</a>
            <a href="tron.html" class="active">Tron</a>
            <a href="polkadot.html">Polkadot</a>
        </nav>

        <div class="info-box">
            <h4>âš¡ Tron ç°½åèˆ‡äº¤æ˜“</h4>
            <p>Tron ä½¿ç”¨ ECDSA (secp256k1) é€²è¡Œç°½åï¼Œèˆ‡ Ethereum é¡ä¼¼ä½†åœ°å€æ ¼å¼ä¸åŒã€‚Tron åœ°å€ä»¥ T é–‹é ­ï¼Œä½¿ç”¨ Base58Check ç·¨ç¢¼ã€‚æ”¯æ´ TRC-10 å’Œ TRC-20 ä»£å¹£æ¨™æº–ã€‚</p>
        </div>

        <div class="demo-section">
            <h3>1. ç”Ÿæˆ Tron éŒ¢åŒ…</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'tron-wallet-code')">è¤‡è£½</button>
                </div>
                <pre><code id="tron-wallet-code" class="language-javascript">// Tron ä½¿ç”¨ secp256k1 (èˆ‡ Ethereum ç›¸åŒ)
const EC = require('elliptic').ec;
const ec = new EC('secp256k1');

// ç”Ÿæˆå¯†é‘°å°
const keyPair = ec.genKeyPair();
const privateKey = keyPair.getPrivate('hex');
const publicKey = keyPair.getPublic('hex');

// Tron åœ°å€ç”Ÿæˆ
// 1. Keccak-256 å…¬é‘°å¾Œå–å¾Œ 20 bytes
const address20 = keccak256(publicKey).slice(-40);
// 2. æ·»åŠ å‰ç¶´ 0x41 (Tron ä¸»ç¶²)
const addressWithPrefix = '41' + address20;
// 3. Base58Check ç·¨ç¢¼
const tronAddress = base58CheckEncode(addressWithPrefix);
// çµæœ: T... (ä¸»ç¶²åœ°å€ä»¥ T é–‹é ­)</code></pre>
            </div>

            <button onclick="generateTronWallet()">ç”Ÿæˆ Tron éŒ¢åŒ…</button>
            <div id="tronWalletOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>2. ç°½ç½²è¨Šæ¯</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'tron-sign-code')">è¤‡è£½</button>
                </div>
                <pre><code id="tron-sign-code" class="language-javascript">// Tron è¨Šæ¯ç°½å
const message = "Tron message";
const prefix = "\x19TRON Signed Message:\n32";
const fullMessage = prefix + message;

// é›œæ¹Šè¨Šæ¯
const msgHash = CryptoJS.SHA256(fullMessage).toString();

// ç°½ç½²
const signature = keyPair.sign(msgHash);
const r = signature.r.toString('hex');
const s = signature.s.toString('hex');
const v = signature.recoveryParam + 27; // Recovery ID

// Tron ç°½åæ ¼å¼: r + s + v
const tronSignature = r + s + v.toString(16);

// é©—è­‰
const valid = keyPair.verify(msgHash, signature);
console.log("ç°½åæœ‰æ•ˆ:", valid);</code></pre>
            </div>

            <div class="input-group">
                <label>è¨Šæ¯ï¼š</label>
                <input type="text" id="tronMessage" value="Tron Power!" placeholder="è¼¸å…¥è¦ç°½ç½²çš„è¨Šæ¯">
            </div>
            <button onclick="signTronMessage()">âœï¸ ç°½ç½²è¨Šæ¯</button>
            <button onclick="verifyTronMessage()">âœ… é©—è­‰ç°½å</button>
            <div id="tronMessageOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>3. å»ºç«‹ä¸¦ç°½ç½²è½‰å¸³äº¤æ˜“</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'tron-tx-code')">è¤‡è£½</button>
                </div>
                <pre><code id="tron-tx-code" class="language-javascript">// Tron äº¤æ˜“çµæ§‹
const transaction = {
    txID: "", // äº¤æ˜“ ID (è¨ˆç®—å¾Œå¡«å…¥)
    raw_data: {
        contract: [{
            type: "TransferContract",
            parameter: {
                value: {
                    amount: 1000000, // 1 TRX = 1,000,000 sun
                    owner_address: fromAddressHex,
                    to_address: toAddressHex
                }
            }
        }],
        ref_block_bytes: "...", // åƒè€ƒå€å¡Š
        ref_block_hash: "...",
        expiration: timestamp + 60000, // éæœŸæ™‚é–“
        timestamp: timestamp
    }
};

// è¨ˆç®—äº¤æ˜“ ID (SHA-256 raw_data)
const txID = SHA256(JSON.stringify(transaction.raw_data));
transaction.txID = txID;

// ç°½ç½²äº¤æ˜“
const signature = signTransaction(privateKey, txID);
transaction.signature = [signature];

// å»£æ’­äº¤æ˜“
// POST to https://api.trongrid.io/wallet/broadcasttransaction</code></pre>
            </div>

            <div class="input-group">
                <label>æ”¶æ¬¾åœ°å€ï¼š</label>
                <input type="text" id="tronToAddress" value="TLPnVWjh4PGcDXXw8rST1rWFaE5uBb8pP" placeholder="T...">
            </div>
            <div class="input-group">
                <label>é‡‘é¡ (TRX)ï¼š</label>
                <input type="text" id="tronAmount" value="1" placeholder="1">
            </div>
            <button onclick="createTronTransaction()">ğŸ“ å»ºç«‹ä¸¦ç°½ç½²äº¤æ˜“</button>
            <div id="tronTxOutput" class="output"></div>
        </div>

        <div class="demo-section">
            <h3>4. TRC-20 ä»£å¹£äº¤æ˜“</h3>
            
            <div class="code-section">
                <div class="code-header">
                    <h4>ğŸ’» JavaScript ç¯„ä¾‹</h4>
                    <button class="copy-btn" onclick="copyCode(this, 'trc20-code')">è¤‡è£½</button>
                </div>
                <pre><code id="trc20-code" class="language-javascript">// TRC-20 ä»£å¹£è½‰å¸³ (é¡ä¼¼ ERC-20)
const transaction = {
    raw_data: {
        contract: [{
            type: "TriggerSmartContract",
            parameter: {
                value: {
                    owner_address: fromAddressHex,
                    contract_address: tokenContractAddress,
                    data: encodeTransferData(toAddress, amount)
                }
            }
        }]
    }
};

// ç·¨ç¢¼ transfer(address,uint256) å‡½æ•¸
function encodeTransferData(toAddress, amount) {
    // å‡½æ•¸é¸æ“‡å™¨: transfer(address,uint256)
    const methodId = 'a9059cbb';
    // åƒæ•¸: åœ°å€ (32 bytes) + é‡‘é¡ (32 bytes)
    const paddedAddress = toAddress.padStart(64, '0');
    const paddedAmount = amount.toString(16).padStart(64, '0');
    return methodId + paddedAddress + paddedAmount;
}

// USDT-TRC20: TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t</code></pre>
            </div>

            <div class="input-group">
                <label>ä»£å¹£åˆç´„åœ°å€ï¼š</label>
                <input type="text" id="trc20Contract" value="TR7NHqjeKQxGTCi8q8ZY4pL8otSzgjLj6t" placeholder="USDT-TRC20">
            </div>
            <div class="input-group">
                <label>æ”¶æ¬¾åœ°å€ï¼š</label>
                <input type="text" id="trc20ToAddress" value="TLPnVWjh4PGcDXXw8rST1rWFaE5uBb8pP" placeholder="T...">
            </div>
            <div class="input-group">
                <label>é‡‘é¡ï¼š</label>
                <input type="text" id="trc20Amount" value="10" placeholder="10">
            </div>
            <button onclick="createTRC20Transaction()">ğŸ“ å»ºç«‹ TRC-20 äº¤æ˜“</button>
            <div id="trc20Output" class="output"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/elliptic/6.5.4/elliptic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="../scripts/tron.js"></script>
    <script>
        function copyCode(btn, codeId) {
            const code = document.getElementById(codeId).textContent;
            navigator.clipboard.writeText(code).then(() => {
                btn.textContent = 'å·²è¤‡è£½ï¼';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'è¤‡è£½';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }
    </script>
</body>
</html>
